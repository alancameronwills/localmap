// Azure Storage JavaScript Client Library 0.2.8-preview.14 
// Copyright (c) Microsoft and contributors. All rights reserved. 
require=function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return o(r||e)},c,c.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({4:[function(e,t,r){var n=window.AzureStorage||{};n.generateDevelopmentStorageCredentials=function(e){var t="UseDevelopmentStorage=true;";return e&&(t+="DevelopmentStorageProxyUri="+e),t};var o=e("../lib/services/table/tableservice");n.TableService=o,n.TableQuery=e("../lib/services/table/tablequery"),n.TableBatch=e("../lib/services/table/tablebatch"),n.TableUtilities=e("../lib/services/table/tableutilities"),n.createTableService=function(e,t,r){return new o(e,t,r)},n.createTableServiceWithSas=function(e,t){return new o(null,null,e,t)};var i=e("../lib/common/common.browser"),s=i.StorageServiceClient,a=i.SharedKey;n.generateAccountSharedAccessSignature=function(e,t,r){var n=s.getStorageSettings(e,t);return new a(n._name,n._key).generateAccountSignedQueryString(r)},n.Constants=i.Constants,n.StorageUtilities=i.StorageUtilities,n.AccessCondition=i.AccessCondition,n.SR=i.SR,n.StorageServiceClient=s,n.Logger=i.Logger,n.WebResource=i.WebResource,n.Validate=i.validate,n.date=i.date,n.LinearRetryPolicyFilter=i.LinearRetryPolicyFilter,n.ExponentialRetryPolicyFilter=i.ExponentialRetryPolicyFilter,n.RetryPolicyFilter=i.RetryPolicyFilter,window.AzureStorage=n},{"../lib/common/common.browser":5,"../lib/services/table/tablebatch":69,"../lib/services/table/tablequery":70,"../lib/services/table/tableservice":71,"../lib/services/table/tableutilities":72}],71:[function(e,t,r){(function(r){var n=e("util"),o=e("extend"),i=e("underscore"),s=e("./../../common/common.core"),a=s.util,l=s.validate,u=s.SR,c=s.StorageServiceClient,p=e("./internal/sharedkeytable"),E=e("./internal/requesthandler"),f=e("./tablequery"),T=s.WebResource,d=s.Constants,y=d.QueryStringConstants,h=d.HeaderConstants,R=d.TableConstants,b=d.RequestLocationMode,_=e("./models/tableresult"),A=e("./models/entityresult"),g=e("./models/batchresult"),m=s.ServiceStatsParser,N=s.AclResult,O=e("./tableutilities");function v(e,t,r,n,o){var i=c.getStorageSettings(e,t,r,n,o);if(v.super_.call(this,i._name,i._key,i._tableEndpoint,i._usePathStyleUri,i._sasToken),this.anonymous)throw new Error(u.ANONYMOUS_ACCESS_BLOBSERVICE_ONLY);this.storageAccount&&this.storageAccessKey&&(this.storageCredentials=new p(this.storageAccount,this.storageAccessKey,this.usePathStyleUri)),this.defaultPayloadFormat=O.PayloadFormat.MINIMAL_METADATA}n.inherits(v,c),v.prototype.getServiceStats=function(e,t){var r;a.normalizeArgs(e,t,function(e,n){r=e,t=n}),l.validateArgs("getServiceStats",function(e){e.callback(t)});var n=o(!0,{},r);n.requestLocationMode=d.RequestLocationMode.PRIMARY_OR_SECONDARY;var i=T.get().withQueryOption(y.COMP,"stats").withQueryOption(y.RESTYPE,"service");this.performRequest(i,null,n,function(e,r){e.serviceStatsResult=null,e.error||(e.serviceStatsResult=m.parse(e.response.body.StorageServiceStats));r(e,function(e){t(e.error,e.serviceStatsResult,e.response)})})},v.prototype.getServiceProperties=function(e,t){return this.getAccountServiceProperties(e,t)},v.prototype.setServiceProperties=function(e,t,r){return this.setAccountServiceProperties(e,t,r)},v.prototype.listTablesSegmented=function(e,t,r){this.listTablesSegmentedWithPrefix(null,e,t,r)},v.prototype.listTablesSegmentedWithPrefix=function(e,t,r,n){var i;a.normalizeArgs(r,n,function(e,t){i=e,n=t}),l.validateArgs("listTables",function(e){e.callback(n)});var s=o(!0,{},i);s.payloadFormat=s.payloadFormat||this.defaultPayloadFormat;var u=T.get(R.TABLE_SERVICE_TABLE_NAME);if(E.setTableRequestHeadersAndBody(u,null,s.payloadFormat),a.objectIsNull(t)||u.withQueryOption(R.NEXT_TABLE_NAME,t.nextTableName),!a.objectIsNull(e)){var c=(new f).where(R.TABLE_NAME+" >= ?",e).and(R.TABLE_NAME+" < ?",e+"{");u.withQueryOption(y.FILTER,c.toQueryObject().$filter)}if(!a.objectIsNull(s.maxResults)){c=(new f).top(s.maxResults);u.withQueryOption(y.TOP,c.toQueryObject().$top)}s.requestLocationMode=a.getNextListingLocationMode(t);this.performRequest(u,null,s,function(e,t){e.listTablesResult=null,e.error||(e.listTablesResult={entries:null,continuationToken:null},e.listTablesResult.entries=_.parse(e.response),e.response.headers[R.CONTINUATION_NEXT_TABLE_NAME]&&!a.objectIsEmpty(e.response.headers[R.CONTINUATION_NEXT_TABLE_NAME])&&(e.listTablesResult.continuationToken={nextTableName:null,targetLocation:null},e.listTablesResult.continuationToken.nextTableName=e.response.headers[R.CONTINUATION_NEXT_TABLE_NAME],e.listTablesResult.continuationToken.targetLocation=e.targetLocation));t(e,function(e){n(e.error,e.listTablesResult,e.response)})})},v.prototype.getTableAcl=function(e,t,r){var n;a.normalizeArgs(t,r,function(e,t){n=e,r=t}),l.validateArgs("getTableAcl",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var i=o(!0,{},n);i.requestLocationMode=d.RequestLocationMode.PRIMARY_OR_SECONDARY;var s=T.get(e).withQueryOption(y.COMP,"acl");this.performRequest(s,null,i,function(t,n){t.tableResult=null,t.error||(t.tableResult=new _(e),t.tableResult.signedIdentifiers=N.parse(t.response.body));n(t,function(e){r(e.error,e.tableResult,e.response)})})},v.prototype.setTableAcl=function(e,t,n,s){var c;a.normalizeArgs(n,s,function(e,t){c=e,s=t}),l.validateArgs("setTableAcl",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(s)});var p=o(!0,{},c),E=null;if(t){if(i.isArray(t))throw new TypeError(u.INVALID_SIGNED_IDENTIFIERS);E=N.serialize(t)}var f=T.put(e).withQueryOption(y.COMP,"acl").withHeader(h.CONTENT_LENGTH,a.objectIsNull(E)?0:r.byteLength(E)).withBody(E);this.performRequest(f,f.body,p,function(r,n){r.tableResult=null,r.error||(r.tableResult=new _(e),t&&(r.tableResult.signedIdentifiers=t));n(r,function(e){s(e.error,e.tableResult,e.response)})})},v.prototype.generateSharedAccessSignature=function(e,t){if(!this.storageCredentials||!this.storageCredentials.generateSignedQueryString)throw new Error(u.CANNOT_CREATE_SAS_WITHOUT_ACCOUNT_KEY);l.validateArgs("generateSharedAccessSignature",function(r){r.string(e,"table"),r.tableNameIsValid(e),r.object(t,"sharedAccessPolicy")});var r=e.toLowerCase();return this.storageCredentials.generateSignedQueryString(d.ServiceType.Table,r,t,null,{tableName:r})},v.prototype.doesTableExist=function(e,t,r){this._doesTableExist(e,!1,t,r)},v.prototype.createTable=function(e,t,r){var n;a.normalizeArgs(t,r,function(e,t){n=e,r=t}),l.validateArgs("createTable",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var i=o(!0,{},n),s=_.serialize(e),u=T.post("Tables").withHeader(h.PREFER,h.PREFER_NO_CONTENT);E.setTableRequestHeadersAndBody(u,s,this.defaultPayloadFormat);this.performRequest(u,u.body,i,function(t,n){t.tableResponse={},t.tableResponse.isSuccessful=!t.error,t.tableResponse.statusCode=t.response.statusCode,t.error||(t.tableResponse.TableName=e);n(t,function(e){r(e.error,e.tableResponse,e.response)})})},v.prototype.createTableIfNotExists=function(e,t,r){var n;a.normalizeArgs(t,r,function(e,t){n=e,r=t}),l.validateArgs("createTableIfNotExists",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var i=o(!0,{},n),s=this;s._doesTableExist(e,!0,i,function(t,n,o){var a=n.exists;n.created=!1,delete n.exists,t?r(t,n,o):a?(o.isSuccessful=!0,r(t,n,o)):s.createTable(e,i,function(e,t,n){e?e&&e.statusCode===d.HttpConstants.HttpResponseCodes.Conflict&&e.code===d.TableErrorCodeStrings.TABLE_ALREADY_EXISTS&&(e=null,t.created=!1,t.isSuccessful=!0):t.created=!0,r(e,t,n)})})},v.prototype.deleteTable=function(e,t,r){var n;a.normalizeArgs(t,r,function(e,t){n=e,r=t}),l.validateArgs("deleteTable",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var i=o(!0,{},n),s=T.del("Tables('"+e+"')");E.setTableRequestHeadersAndBody(s,null,this.defaultPayloadFormat);this.performRequest(s,null,i,function(e,t){t(e,function(e){r(e.error,e.response)})})},v.prototype.deleteTableIfExists=function(e,t,r){var n;a.normalizeArgs(t,r,function(e,t){n=e,r=t}),l.validateArgs("deleteTableIfExists",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(r)});var i=o(!0,{},n),s=this;s._doesTableExist(e,!0,i,function(t,n,o){t?r(t,n.exists,o):n.exists?s.deleteTable(e,i,function(e,t){var n;e?e&&e.statusCode===d.HttpConstants.HttpResponseCodes.NotFound&&e.code===d.StorageErrorCodeStrings.RESOURCE_NOT_FOUND&&(n=!1,e=null,t.isSuccessful=!0):n=!0,r(e,n,t)}):(o.isSuccessful=!0,r(t,!1,o))})},v.prototype.queryEntities=function(e,t,r,n,i){var s;a.normalizeArgs(n,i,function(e,t){s=e,i=t}),l.validateArgs("queryEntities",function(t){t.string(e,"table"),t.callback(i)});var u=o(!0,{},s);u.payloadFormat=u.payloadFormat||this.defaultPayloadFormat;var c=T.get(e);if(E.setTableRequestHeadersAndBody(c,null,u.payloadFormat),t){var p=t.toQueryObject();Object.keys(p).forEach(function(e){c.withQueryOption(e,p[e])})}a.objectIsNull(r)||(c.withQueryOption(R.NEXT_PARTITION_KEY,r.nextPartitionKey),c.withQueryOption(R.NEXT_ROW_KEY,r.nextRowKey)),u.requestLocationMode=a.getNextListingLocationMode(r);this.performRequest(c,null,u,function(e,t){if(e.queryEntitiesResult=null,!e.error){e.queryEntitiesResult={entries:null,continuationToken:null},e.queryEntitiesResult.entries=A.parseQuery(e.response,u.autoResolveProperties,u.propertyResolver,u.entityResolver);var r={nextPartitionKey:e.response.headers[R.CONTINUATION_NEXT_PARTITION_KEY],nextRowKey:e.response.headers[R.CONTINUATION_NEXT_ROW_KEY],targetLocation:e.targetLocation};a.IsNullOrEmptyOrUndefinedOrWhiteSpace(r.nextPartitionKey)||(e.queryEntitiesResult.continuationToken=r)}t(e,function(e){i(e.error,e.queryEntitiesResult,e.response)})})},v.prototype.retrieveEntity=function(e,t,r,n,o){var i={PartitionKey:{_:t,$:"Edm.String"},RowKey:{_:r,$:"Edm.String"}};l.validateArgs("retrieveEntity",function(e){e.stringAllowEmpty(t,"partitionKey"),e.stringAllowEmpty(r,"rowKey")}),this._performEntityOperation(R.Operations.RETRIEVE,e,i,n,o)},v.prototype.insertEntity=function(e,t,r,n){this._performEntityOperation(R.Operations.INSERT,e,t,r,n)},v.prototype.insertOrReplaceEntity=function(e,t,r,n){this._performEntityOperation(R.Operations.INSERT_OR_REPLACE,e,t,r,n)},v.prototype.replaceEntity=function(e,t,r,n){this._performEntityOperation(R.Operations.REPLACE,e,t,r,n)},v.prototype.mergeEntity=function(e,t,r,n){this._performEntityOperation(R.Operations.MERGE,e,t,r,n)},v.prototype.insertOrMergeEntity=function(e,t,r,n){this._performEntityOperation(R.Operations.INSERT_OR_MERGE,e,t,r,n)},v.prototype.deleteEntity=function(e,t,r,n){this._performEntityOperation(R.Operations.DELETE,e,t,r,n)},v.prototype.executeBatch=function(e,t,n,i){var s;if(a.normalizeArgs(n,i,function(e,t){s=e,i=t}),l.validateArgs("executeBatch",function(r){r.string(e,"table"),r.tableNameIsValid(e),r.object(t,"batch"),r.callback(i)}),!t.hasOperations())throw new Error(u.EMPTY_BATCH);var c=o(!0,{},s),p=new g(this,e,t.operations),E=p.constructWebResource(),f=p.serialize();E.withBody(f),E.withHeader(h.CONTENT_LENGTH,r.byteLength(f,"utf8"));this.performRequest(E,E.body,c,function(e,t){var r=p.parse(e),n=!0;r&&r.length>0&&r.forEach(function(t){n&&!t.response.isSuccessful&&(e=t,n=!1)}),n&&(e.operationResponses=r);t(e,function(e){i(e.error,e.operationResponses,e.response)})})},v.prototype._doesTableExist=function(e,t,r,n){var i;a.normalizeArgs(r,n,function(e,t){i=e,n=t}),l.validateArgs("doesTableExist",function(t){t.string(e,"table"),t.tableNameIsValid(e),t.callback(n)});var s=o(!0,{},i);!1===t&&(s.requestLocationMode=b.PRIMARY_OR_SECONDARY);var u=T.get("Tables('"+e+"')");u.withHeader(h.ACCEPT,this.defaultPayloadFormat);this.performRequest(u,null,s,function(t,r){t.tableResult={},t.tableResult.isSuccessful=!t.error,t.tableResult.statusCode=null===t.response||void 0===t.response?void 0:t.response.statusCode,t.tableResult.TableName=e,t.error?t.error&&t.error.statusCode===d.HttpConstants.HttpResponseCodes.NotFound&&(t.error=null,t.tableResult.exists=!1,t.response.isSuccessful=!0):t.tableResult.exists=!0;r(t,function(e){n(e.error,e.tableResult,e.response)})})},v.prototype._performEntityOperation=function(e,t,r,n,i){var s;a.normalizeArgs(n,i,function(e,t){s=e,i=t}),l.validateArgs("entityOperation",function(e){e.string(t,"table"),e.tableNameIsValid(t),e.object(r,"entityDescriptor"),"string"!=typeof r.PartitionKey&&(e.object(r.PartitionKey,"entityDescriptor.PartitionKey"),e.stringAllowEmpty(r.PartitionKey._,"entityDescriptor.PartitionKey._")),"string"!=typeof r.RowKey&&(e.object(r.RowKey,"entityDescriptor.RowKey"),e.stringAllowEmpty(r.RowKey._,"entityDescriptor.RowKey._")),e.callback(i)});var u=o(!0,{},s);u.payloadFormat=u.payloadFormat||this.defaultPayloadFormat;var c=E.constructEntityWebResource(e,t,r,u);this.performRequest(c,c.body,u,function(t,r){var n;e===R.Operations.DELETE?n=function(e){i(e.error,e.response)}:(t.entityResponse=null,t.error||(t.entityResponse=A.parseEntity(t.response,u.autoResolveProperties,u.propertyResolver,u.entityResolver)),n=function(e){i(e.error,e.entityResponse,e.response)}),r(t,n)})},v.prototype.getUrl=function(e,t,r){return l.validateArgs("getUrl",function(t){t.string(e,"table"),t.tableNameIsValid(e)}),this._getUrl(e,t,r)},t.exports=v}).call(this,e("buffer").Buffer)},{"./../../common/common.core":6,"./internal/requesthandler":64,"./internal/sharedkeytable":65,"./models/batchresult":66,"./models/entityresult":67,"./models/tableresult":68,"./tablequery":70,"./tableutilities":72,buffer:"buffer",extend:158,underscore:249,util:"util"}],68:[function(e,t,r){var n=e("../internal/odatahandler");function o(e){this.name=e}o.serialize=function(e){return JSON.stringify({TableName:e})},o.parse=function(e){var t=null;return e.body&&(t=n.parseJsonTables(e.body)),t},t.exports=o},{"../internal/odatahandler":63}],66:[function(e,t,r){var n=e("./../../../common/common.core"),o=e("./../../../common/md5-wrapper"),i=n.StorageServiceClient,s=n.WebResource,a=n.Constants,l=a.HeaderConstants,u=a.TableConstants,c=e("../internal/requesthandler"),p=e("./entityresult");function E(e,t,r){this.tableService=e,this.table=t,this.operations=r,this.batchBoundary="batch_"+E._getBoundary(),this.changesetBoundary="changeset_"+E._getBoundary()}E._getBoundary=function(){return(new o).createMd5Hash().update(""+(new Date).getTime()).digest("hex")},E.prototype.constructWebResource=function(){var e=s.post("$batch").withRawResponse(!0);return e.withHeader(l.CONTENT_TYPE,'multipart/mixed; charset="utf-8"; boundary='+this.batchBoundary),e.withHeader(l.DATA_SERVICE_VERSION,"3.0;"),e.withHeader(l.MAX_DATA_SERVICE_VERSION,"3.0;NetFx"),e},E.prototype.serialize=function(){var e="--"+this.batchBoundary+"\n";if(1===this.operations.length&&this.operations[0].type===u.Operations.RETRIEVE)e+=l.CONTENT_TYPE+": application/http\n",e+=l.CONTENT_TRANSFER_ENCODING+": binary\n\n",e+=this._serializeOperation(this.operations[0]);else{e+=l.CONTENT_TYPE+': multipart/mixed;charset="utf-8";boundary='+this.changesetBoundary+"\n\n";for(var t=0;t<this.operations.length;t++)e+="--"+this.changesetBoundary+"\n",e+=l.CONTENT_TYPE+": application/http\n",e+=l.CONTENT_TRANSFER_ENCODING+": binary\n\n",e+=this._serializeOperation(this.operations[t],t)+"\n";e+="--"+this.changesetBoundary+"--\n"}return e+="--"+this.batchBoundary+"--"},E.prototype._serializeOperation=function(e,t){e.options.payloadFormat=e.options.payloadFormat||this.tableService.defaultPayloadFormat;var r=c.constructEntityWebResource(e.type,this.table,e.entity,e.options);t&&(r.headers[l.CONTENT_ID]=t),r.headers[l.CONTENT_TYPE]&&(r.headers[l.CONTENT_TYPE]+="type=entry"),this.tableService._setRequestUrl(r);var n=r.method+" "+r.uri+" HTTP/1.1\n";return Object.keys(r.headers).forEach(function(e){n+=e+": "+r.headers[e]+"\n"}),n+="\n",n+=r.body||""},E.prototype.parse=function(e){var t=null;if(e&&e.response&&e.response.body&&"string"==typeof e.response.body){t=[];var r=e.response.body.split(u.CHANGESET_DELIMITER);1===r.length&&(r=e.response.body.split(u.BATCH_DELIMITER));var n=this;r.forEach(function(e){var r=e.indexOf("HTTP/1.1");if(-1!==r){e=e.substring(r);var o=n._parseOperation(e);t.push(o)}})}return t},E.prototype._parseOperation=function(e){var t={error:null,response:{}},r=e.split("\r\n");if(r.length>0){var n=r.shift().split(" ");n.length>=2&&(t.response.statusCode=parseInt(n[1]),t.response.isSuccessful=s.validResponse(t.response.statusCode)),t.response.headers={},t.response.body="";var o=!1;if(r.forEach(function(e){if(""!==e||o)if(o)t.response.body+=e;else{var r=e.indexOf(":");-1!==r&&(t.response.headers[e.substring(0,r).trim().toLowerCase()]=e.substring(r+1).trim())}else o=!0}),i._parseResponse(t.response,this.tableService.xml2jsSettings),t.response.isSuccessful||(t.error=i._normalizeError(t.response.body,t.response)),!t.error){var a,u,c=t.response.headers[l.CONTENT_ID]||0;if(c&&this.operations[c]){var E=this.operations[c].options;a=E.propertyResolver,u=E.entityResolver}t.entity=p.parseEntity(t.response,a,u)}}return t},t.exports=E},{"../internal/requesthandler":64,"./../../../common/common.core":6,"./../../../common/md5-wrapper":13,"./entityresult":67}],65:[function(e,t,r){var n=e("util"),o=e("./../../../common/common.core"),i=o.SharedKey,s=o.util,a=o.Constants,l=a.HeaderConstants,u=a.QueryStringConstants;function c(e,t,r){c.super_.call(this,e,t,r)}n.inherits(c,i),c.prototype.signRequest=function(e,t){var r=function(e){return s.objectIsNull(e)?"\n":e+"\n"},n=e.method+"\n"+r(e.headers[l.CONTENT_MD5])+r(e.headers[l.CONTENT_TYPE])+r(e.headers[l.MS_DATE])+this._getCanonicalizedResource(e),o=this.signer.sign(n);e.withHeader(l.AUTHORIZATION,"SharedKey "+this.storageAccount+":"+o),t(null)},c.prototype._getCanonicalizedResource=function(e){var t="/";e.path&&(t=e.path);var r="/"+this.storageAccount+t,n=e.queryString;return n[u.COMP]&&(r+="?comp="+n[u.COMP]),r},t.exports=c},{"./../../../common/common.core":6,util:"util"}],64:[function(e,t,r){(function(n){var o=e("util"),i=e("./../../../common/common.core"),s=i.WebResource,a=i.SR,l=i.Constants,u=l.HeaderConstants,c=l.TableConstants,p=e("../models/entityresult");(r=t.exports).constructEntityWebResource=function(e,t,n,i){var l,E=null;if(e===c.Operations.INSERT)E=s.post(t).withHeader(u.PREFER,i.echoContent?u.PREFER_CONTENT:u.PREFER_NO_CONTENT);else{var f=function(e,t,r){var n="/"+e;if("string"!=typeof t||"string"!=typeof r)throw new Error(a.INCORRECT_ENTITY_KEYS);return t=t.replace(/'/g,"''"),r=r.replace(/'/g,"''"),n=n+"(PartitionKey='"+encodeURIComponent(t.toString("utf8"))+"',RowKey='"+encodeURIComponent(r.toString("utf8"))+"')"}(t,"string"==typeof n.PartitionKey?n.PartitionKey:n.PartitionKey[c.ODATA_VALUE_MARKER],"string"==typeof n.RowKey?n.RowKey:n.RowKey[c.ODATA_VALUE_MARKER]);if(e===c.Operations.DELETE)E=s.del(f);else if(e===c.Operations.MERGE||e===c.Operations.INSERT_OR_MERGE)E=s.merge(f);else if(e===c.Operations.REPLACE||e===c.Operations.INSERT_OR_REPLACE)E=s.put(f);else{if(e!==c.Operations.RETRIEVE)throw new Error(o.format(a.INVALID_TABLE_OPERATION,e));E=s.get(f)}}return e!==c.Operations.DELETE&&e!==c.Operations.REPLACE&&e!==c.Operations.MERGE||E.withHeader(u.IF_MATCH,p.getEtag(n)||"*"),e!==c.Operations.DELETE&&e!==c.Operations.RETRIEVE&&(l=p.serialize(n)),r.setTableRequestHeadersAndBody(E,l,i.payloadFormat),E},r.setTableRequestHeadersAndBody=function(e,t,r){t&&e.withHeader(u.CONTENT_LENGTH,n.byteLength(t,"utf8")).withBody(t).withHeader(u.CONTENT_TYPE,u.JSON_CONTENT_TYPE_VALUE),e.withHeader(u.ACCEPT,r).withHeader(u.MAX_DATA_SERVICE_VERSION,c.DEFAULT_DATA_SERVICE_VERSION)}}).call(this,e("buffer").Buffer)},{"../models/entityresult":67,"./../../../common/common.core":6,buffer:"buffer",util:"util"}],67:[function(e,t,r){var n=e("./../../../common/common.core").Constants,o=n.TableConstants,i=n.HeaderConstants,s=e("../internal/odatahandler");(r=t.exports).serialize=function(e){return s.serializeJson(e)},r.parseQuery=function(e,t,r,n){var o={};return e.body&&(o=s.parseJsonEntities(e.body,t,r,n)),o},r.parseEntity=function(e,t,r,n){var a={};return e.body&&(a=s.parseJsonSingleEntity(e.body,t,r,n)),e.headers&&e.headers[i.ETAG.toLowerCase()]&&(a[o.ODATA_METADATA_MARKER]||(a[o.ODATA_METADATA_MARKER]={}),a[o.ODATA_METADATA_MARKER].etag=e.headers[i.ETAG.toLowerCase()]),a},r.getEtag=function(e){var t;return e&&e[o.ODATA_METADATA_MARKER]&&(t=e[o.ODATA_METADATA_MARKER].etag),t}},{"../internal/odatahandler":63,"./../../../common/common.core":6}],63:[function(e,t,r){(function(n){var o=e("util"),i=e("./../../../common/common.core"),s=i.util,a=i.SR,l=i.Constants,u=e("./edmhandler"),c=l.TableConstants.ODATA_PREFIX.length,p=l.TableConstants.ODATA_TYPE_SUFFIX.length;(r=t.exports).serializeJson=function(e){function t(e){if(s.objectIsNull(e))return{_:e};if("object"==typeof e&&e.hasOwnProperty(l.TableConstants.ODATA_VALUE_MARKER))return e;var t={_:e};return t[l.TableConstants.ODATA_TYPE_MARKER]=u.propertyType(e,!0),t}var r={};for(var n in e)if(n!==l.TableConstants.ODATA_METADATA_MARKER){var o=t(e[n]);if(!s.objectIsNull(o[l.TableConstants.ODATA_VALUE_MARKER])){var i=o[l.TableConstants.ODATA_VALUE_MARKER],a=o[l.TableConstants.ODATA_TYPE_MARKER];void 0===a&&(a=u.propertyType(i,!0)),r[n]=u.serializeValue(a,i),u.isTypeRequired(a,i)&&(r[n+l.TableConstants.ODATA_TYPE_SUFFIX]=a)}}return JSON.stringify(r,function(e,t){return t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":s.objectIsNaN(t)?"NaN":t})},r.parseJsonTables=function(e){var t=[];if(e.value)for(var r=0;r<e.value.length;r++){var n=e.value[r].TableName;t.push(n)}return t},r.parseJsonEntities=function(e,t,n,o){if(e.value){for(var i=[],s=0;s<e.value.length;s++){var a=e.value[s],l=r.parseJsonSingleEntity(a,t,n,o);i.push(l)}return i}return[r.parseJsonSingleEntity(e,t,n,o)]},r.parseJsonSingleEntity=function(e,t,r,i){var E={},f={PartitionKey:"Edm.String",RowKey:"Edm.String",Timestamp:"Edm.DateTime"},T={};for(var d in e)s.stringStartsWith(d,l.TableConstants.ODATA_PREFIX)?T[d.slice(c)]=e[d]:s.stringEndsWith(d,l.TableConstants.ODATA_TYPE_SUFFIX)?f[d.slice(0,d.length-p)]=e[d]:E[d]=e[d];if(!T.etag&&E.Timestamp){var y=new n(E.Timestamp).toString();T.etag="W/\"datetime'"+y+"'\""}var h={};for(var d in E)if(E.hasOwnProperty(d)){var R=f[d];h[d]={},r&&(R=r(E.PartitionKey,E.RowKey,d,E[d],R)),!R&&t&&(R=u.propertyType(E[d],!1)),R&&(h[d][l.TableConstants.ODATA_TYPE_MARKER]=R);try{h[d][l.TableConstants.ODATA_VALUE_MARKER]=u.deserializeValueFromJson(R,E[d])}catch(e){throw r?new Error(o.format(a.INVALID_PROPERTY_RESOLVER,d,R,E[d])):e}}return h[l.TableConstants.ODATA_METADATA_MARKER]=T,i&&(h=i(h)),h}}).call(this,e("buffer").Buffer)},{"./../../../common/common.core":6,"./edmhandler":62,buffer:"buffer",util:"util"}],70:[function(e,t,r){var n=e("underscore"),o=e("util"),i=e("./../../common/common.core"),s=i.util,a=i.SR,l=i.Constants.QueryStringConstants,u=e("./internal/edmhandler"),c=e("./tableutilities"),p=c.QueryComparisons,E=c.TableOperators,f=c.EdmType;function T(){this._fields=[],this._where=[],this._top=null}T.prototype.select=function(){var e=this;return arguments&&n.each(arguments,function(t){e._fields.push(t)}),this},T.prototype.top=function(e){return this._top=e,this},T.prototype.where=function(e){return this._where.push(T._encodeConditionString(e,arguments)),this},T.int32Filter=function(e,t,r){return T._concatFilterString(e,t,r,f.INT32)},T.int64Filter=function(e,t,r){return T._concatFilterString(e,t,r,f.INT64)},T.doubleFilter=function(e,t,r){return T._concatFilterString(e,t,r,f.DOUBLE)},T.booleanFilter=function(e,t,r){return T._concatFilterString(e,t,r,f.BOOLEAN)},T.dateFilter=function(e,t,r){return T._concatFilterString(e,t,r,f.DATETIME)},T.guidFilter=function(e,t,r){return T._concatFilterString(e,t,r,f.GUID)},T.binaryFilter=function(e,t,r){return T._concatFilterString(e,t,r,f.BINARY)},T.stringFilter=function(e,t,r){return T._concatFilterString(e,t,r,f.STRING)},T.combineFilters=function(e,t,r){return e+" "+t+" "+r},T.prototype.and=function(e){if(0===this._where.length)throw new Error(o.format(a.QUERY_OPERATOR_REQUIRES_WHERE,"AND"));return this._where.push(" and "+T._encodeConditionString(e,arguments)),this},T.prototype.or=function(e){if(0===this._where.length)throw new Error(o.format(a.QUERY_OPERATOR_REQUIRES_WHERE,"OR"));return this._where.push(" or "+T._encodeConditionString(e,arguments)),this},T.prototype.toQueryObject=function(){var e={};return this._fields.length>0&&(e[l.SELECT]=this._fields.join(",")),this._where.length>0&&(e[l.FILTER]=this._where.join("")),this._top&&(e[l.TOP]=this._top),e},T._concatFilterString=function(e,t,r,n){if(s.objectIsNull(e))throw new Error(o.format(a.ARGUMENT_NULL_OR_UNDEFINED,"propertyName"));if(s.objectIsNull(t))throw new Error(o.format(a.ARGUMENT_NULL_OR_UNDEFINED,"operation"));if(s.objectIsNull(r))throw new Error(o.format(a.ARGUMENT_NULL_OR_UNDEFINED,"value"));return e+" "+t+" "+u.serializeQueryValue(r,n)},T._encodeConditionString=function(e,t){var r=T._replaceOperators(e);if(t.length>1){for(var n=r.split(/(\?string\?|\?int32\?|\?int64\?|\?bool\?|\?double\?|\?date\?|\?binary\?|\?guid\?|\?)/),o=1,i=0;i<n.length&&o<t.length;i++)if(0===n[i].indexOf("?")){var s=T._getEdmType(n[i]);n[i]=u.serializeQueryValue(t[o],s),o++}r=n.join("")}return r},T._getEdmType=function(e){switch(e){case"?binary?":return f.BINARY;case"?int64?":return f.INT64;case"?date?":return f.DATETIME;case"?guid?":return f.GUID;case"?int32?":return f.INT32;case"?double?":return f.DOUBLE;case"?bool?":return f.BOOLEAN;case"?string?":return f.STRING;default:return}},T._replaceOperators=function(e){var t=e.replace(/ == /g," "+p.EQUAL+" ");return t=(t=(t=(t=(t=(t=(t=(t=t.replace(/ != /g," "+p.NOT_EQUAL+" ")).replace(/ >= /g," "+p.GREATER_THAN_OR_EQUAL+" ")).replace(/ > /g," "+p.GREATER_THAN+" ")).replace(/ <= /g," "+p.LESS_THAN_OR_EQUAL+" ")).replace(/ < /g," "+p.LESS_THAN+" ")).replace(/ \&\& /g," "+E.AND+" ")).replace(/ \|\| /g," "+E.OR+" ")).replace(/!/g,E.NOT)},t.exports=T},{"./../../common/common.core":6,"./internal/edmhandler":62,"./tableutilities":72,underscore:249,util:"util"}],62:[function(e,t,r){(function(t){var n=e("underscore"),o=e("util"),i=e("uuid"),s=e("./../../../common/common.core"),a=s.util,l=s.SR,u=e("../tableutilities").EdmType;r.propertyType=function(e,t){return n.isNumber(e)?t?a.objectIsInt(e)?"Edm.Int32":"Edm.Double":null:n.isBoolean(e)?"Edm.Boolean":n.isDate(e)?"Edm.DateTime":"Edm.String"},r.deserializeValueFromJson=function(e,r){if(!e)return r;switch(e){case u.BINARY:return new t(r,"base64");case u.DATETIME:return new Date(r);case u.GUID:return r;case u.DOUBLE:return"number"!=typeof r?parseFloat(r):r;case u.INT32:case u.INT64:case u.STRING:case u.BOOLEAN:return r;default:throw new Error(o.format(l.TYPE_NOT_SUPPORTED,e))}},r.serializeValue=function(e,r){switch(e){case u.BINARY:return t.isBuffer(r)?r.toString("base64"):r;case u.DATETIME:return n.isDate(r)?r.toISOString():r;case u.GUID:return t.isBuffer(r)||n.isArray(r)?i.unparse(r):r;case u.INT64:case u.DOUBLE:return r.toString();case u.INT32:return r===Number.POSITIVE_INFINITY?"Infinity":r===Number.NEGATIVE_INFINITY?"-Infinity":a.objectIsNaN(r)?"NaN":r;case u.STRING:case u.BOOLEAN:return r;default:throw new Error(l.TYPE_NOT_SUPPORTED+e)}},r.isTypeRequired=function(e,t){switch(e){case u.BINARY:case u.INT64:case u.DATETIME:case u.GUID:case u.DOUBLE:return!0;case u.INT32:return!("number"==typeof t&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY&&!a.objectIsNaN(t));case u.STRING:case u.BOOLEAN:return!1;default:throw new Error(o.format(l.TYPE_NOT_SUPPORTED,e))}},r.serializeQueryValue=function(e,t){switch(t||r.propertyType(e,!0)){case u.INT32:return e.toString();case u.BOOLEAN:return e?"true":"false";case u.DOUBLE:return e.toString();case u.INT64:return e.toString()+"L";case u.DATETIME:if(n.isDate(e))return"datetime'"+e.toISOString()+"'";throw new Error(o.format(l.INVALID_EDM_TYPE,e,t));case u.GUID:return"guid'"+e.toString()+"'";case u.BINARY:return"X'"+e.toString("hex")+"'";default:return"'"+e.toString().replace(/'/g,"''")+"'"}}}).call(this,e("buffer").Buffer)},{"../tableutilities":72,"./../../../common/common.core":6,buffer:"buffer",underscore:249,util:"util",uuid:255}],69:[function(e,t,r){var n=e("extend"),o=e("./../../common/common.core"),i=o.SR,s=o.validate,a=o.Constants.TableConstants;function l(){this.operations=[],this.pk=null,this.retrieve=!1}l.prototype.clear=function(){this.operations=[]},l.prototype.hasOperations=function(){return this.operations.length>0},l.prototype.size=function(){return this.operations.length},l.prototype.retrieveEntity=function(e,t,r){var n={PartitionKey:{_:e,$:"Edm.String"},RowKey:{_:t,$:"Edm.String"}};this.addOperation(a.Operations.RETRIEVE,n,r)},l.prototype.insertEntity=function(e,t){this.addOperation(a.Operations.INSERT,e,t)},l.prototype.deleteEntity=function(e){this.addOperation(a.Operations.DELETE,e)},l.prototype.mergeEntity=function(e){this.addOperation(a.Operations.MERGE,e)},l.prototype.replaceEntity=function(e){this.addOperation(a.Operations.REPLACE,e)},l.prototype.insertOrReplaceEntity=function(e){this.addOperation(a.Operations.INSERT_OR_REPLACE,e)},l.prototype.insertOrMergeEntity=function(e){this.addOperation(a.Operations.INSERT_OR_MERGE,e)},l.prototype.addOperation=function(e,t,r){if(s.validateArgs("addOperation",function(e){e.object(t,"entity"),e.object(t.PartitionKey,"entity.PartitionKey"),e.object(t.RowKey,"entity.RowKey"),e.stringAllowEmpty(t.PartitionKey._,"entity.PartitionKey._"),e.stringAllowEmpty(t.RowKey._,"entity.RowKey._")}),this.operations.length>=100)throw new Error(i.BATCH_TOO_LARGE);if(e===a.Operations.RETRIEVE){if(this.hasOperations())throw new Error(i.BATCH_ONE_RETRIEVE);this.retrieve=!0}else if(this.retrieve)throw new Error(i.BATCH_ONE_RETRIEVE);if(this.hasOperations()){if(t.PartitionKey._!==this.pk)throw new Error(i.BATCH_ONE_PARTITION_KEY)}else this.pk=t.PartitionKey._;var o=n(!0,{},r);this.operations.push({type:e,entity:t,options:o})},l.prototype.getOperation=function(e){return this.operations[e]},l.prototype.removeOperation=function(e){var t=this.operations.splice(e,1)[0];return this.hasOperations()||(this.pk=null,this.retrieve=!1),t},t.exports=l},{"./../../common/common.core":6,extend:158}]},{},[4]);
